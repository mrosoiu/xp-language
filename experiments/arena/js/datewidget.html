<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<!--
  Javascript Experiment: A date selection widget
  
  $Id$
-->
<html>
  <head>
    <title>Javascript Experiment: Date "widget"</title>
    <script language="JavaScript">
      function uses() {
        for (i= 0; i < arguments.length; i++) {
          if (typeof this[arguments[i]] == "undefined") {
            throw new Exception("This class requires "+ arguments[i]);
          }
        }
      }
    </script>
    <script language="JavaScript" src="Exception.class.js"></script>
    <script language="JavaScript" src="DateParser.class.js"></script>
    <script language="JavaScript">
      
      function lzero(number) {
        return number < 10 ? "0" + String(number) : String(number);
      }

      function debugString(str) {
        document.forms.select.debug.value += str + "\n";
      }
      
      /**
       * Add 
       *
       * @access  public
       * @param   int years
       * @param   int months
       * @param   int days
       * @return  Date
       */      
      Date.prototype.add= function (years, months, days) {
        d= this;
        if (years) d.setYear(this.getYear() + years);
        if (months) d.setMonth(this.getMonth() + months);
        if (days) d.setDate(this.getDate() + days);
        return d;
      }
      
      /**
       * Format a date
       *
       * @access  public
       * @param   string str the format string
       * @return  string the formatted date
       * @see     php://strftime
       */      
      Date.prototype.format= function (str) {
        var ret= '';
        while (-1 != (pos= str.indexOf('%'))) {
          // debugString('Found token % at position ' + pos + ' of "' + str +'"');
          ret+= str.substring(0, pos);
          switch (str.charAt(pos + 1)) {
            case "d": ret+= lzero(this.getDate()); break;
            case "m": ret+= lzero(this.getMonth()); break;
            case "Y": ret+= String(this.getFullYear()); break;
            // TBI: Rest
          }
          str= str.substring(pos + 2, str.length);
        }
        return ret + str;
      }
    </script>
  </head>
  <body>
    <form name="select">
      <input type="text" name="date" value="19.07."/>
      <a onclick="debugString(new DateParser(document.forms.select.date.value).getDate().format('%d.%m.%Y'));" href="#">=</a>
      <a onclick="debugString(new DateParser(document.forms.select.date.value).getDate().add(0, 0, -1).format('%d.%m.%Y'));" href="#">v</a>
      <a onclick="debugString(new DateParser(document.forms.select.date.value).getDate().add(0, 0, 1).format('%d.%m.%Y'));" href="#">^</a>
      <hr/>
      <a onclick="document.forms.select.debug.value= '';" href="#">clear</a><br/>
      <textarea name="debug" rows="10" cols="72"></textarea>
    </form>
  </body>
</html>
