#!/bin/sh

if [ "$OS" = "Windows_NT" ] ; then
  # Cygwin

  PHPFOUR="/cygdrive/c/Programme/php-4.4.2-Win32/php.exe"
  PHPFIVE="/cygdrive/c/Programme/php-5.1.4-Win32/php.exe"
  REALPATH="cygpath -w"
  TEMP="."
else 
  # Unix

  PHPFOUR=`which php`
  PHPFIVE=`which php5`
  TEMP="/tmp/"
  REALPATH="realpath"
fi

export COMPILE_CMD="`$REALPATH $PHPFOUR` tophp5.php %s"

$PHPFOUR tophp5.php $1 -o $TEMP/t.php5 1 > $TEMP/errors
if [ $? != 0 ] ; then
  cat $TEMP/errors
  rm $TEMP/errors
  exit
fi

$PHPFIVE -d auto_prepend_file=php5-emit/__xp__.php $TEMP/t.php5 $2 $3 $4 $5 $6 $7 $8 $9

# Cleanup
rm $TEMP/errors $TEMP/t.php5
