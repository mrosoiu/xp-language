#!/bin/sh

EXE='php'
IFS=
DIR=`pwd`

echo "<?php
  require('lang.base.php');
  uses('util.cmd.ParamString');
  
  \$params= explode('', '$*');
  \$params[0]= '$DIR/gtkphp';
  \$p= &new ParamString(\$params);
  try(); {
    if ('.class.php' == substr('$1', -10)) {
      require_once('$1');
      \$class= &new XPClass(basename(substr('$1', 0, -10)));
    } else {
      \$class= &XPClass::forName('$1');
    }
    
    if (\$class) {
      \$app= &\$class->newInstance(\$p);
      \$app->init();
    }
  } if (catch('ClassNotFoundException', \$e)) {
    echo '*** Error loading $1: ', \$e->toString();
    exit(-2);
  } if (catch('GuiException', \$e)) {
    echo '*** Error initializing ', \$class->getClassName(), ': ', \$e->toString();
    exit(-1);
  }
  \$app->run();
  \$app->done();
?>" | ${EXE} -q -C -c /usr/local/etc/php.gtk
