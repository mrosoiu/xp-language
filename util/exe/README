Creating executables from PHP sourcecode
======================================================================
$Id$

How is this accomplished?
-------------------------
We simply use SAPI/embed which was actually written for embedding PHP 
sourcecode in programs written in C.
See http://www.zend.com/lists/php-dev/200209/msg01063.html for details

The generator, php2cembed.php, creates C sourcecode from a PHP script,
adds an errorhandler and dumps the contents to stdout. To see what
is done, simply use php -q php2cembed.php /path/to/your/script.php

This C sourcecode is then compiled and libphp4.a is statically linked
to it. This way, no external library is needed except for those 
dynamically linked to libphp4.a. This behaviour may be changed by
configure-options of PHPs configure.

Overview
--------
Makefile            - Make file
README              - This file
errorcb.h           - Error callback function
php2cembed.php      - Creates C sourcecode from a local PHP file
webstart.php        - Create webstart app for URL

How do I create libphp4.a?
--------------------------
Call PHPs configure with --disable-cli --enable-embed=yes --enable-static
to create libphp4.a and libphp4.la

What to do from here?
---------------------
Open your favorite shell and type "make exe src=/path/to/your/script.php".
You may need to specify the directory in which libphp4.a and libphp4.la
reside, so append "PHPLIBDIR=/path/to/.a_and_.la_files/" to your command
line.

What software is needed?
------------------------
- gcc
- libtool
- php (command-line version, CGI will do)

The build process was tested with gcc 2.95.4, libtool 1.4.3 and php 4.2.3

Misc: The error handler
-----------------------
The builtin error handler dumps messages to stderr in this kind of
fashion:

*** Error #2 on line 2 of test
    fopen(http://localhost/notfound) [http://www.php.net/function.fopen]: 
    failed to create stream: HTTP request failed! HTTP/1.1 404 Not Found
*** Error #2 on line 4 of test
    fgets(): supplied argument is not a valid stream resource
*** Error #2 on line 7 of test
    fclose(): supplied argument is not a valid stream resource

Parse errors will look like this:
*** Error #4 on line 6 of test
    parse error, unexpected '}'
*** Internal error

Webstart
--------
An even cooler feature is creating a "thin client" application which loads
PHP applications off the net and then executes them.

No big deal, simply use:
$ make exe src=test.php MAKEEMBED='php -q webstart.php http://localhost/webstart/'
to create the executable.

The sourcecode retrieved from http://localhost/webstart/test.php will then
be executed as soon as the application starts. Attention! The sourcecode shall
neither start with <?php nor end with ?> - either create a wrapper program
on your webserver which will strip these or simply do not include them.

Webstart error messages
-----------------------
An error message issued from the executable looking like this:

*** Error #2 on line 0 of Unknown
    Unknown(http://localhost/webstart/test.php): failed to create stream: 
    HTTP request failed! HTTP/1.1 404 Not Found
*** Failed to initiate

means the webstart target application could not be found. The webstart
creator will issue a warning about this during build time, but, of course,
no guarantee can be given the target still exists at execution time.

The warning issued during compile time looks like this:
test2.c:3: warning: #warning "Retrieving http://foo/test2.php results in 404"

<EOF>
