RFC 0061: No access on raw environment values
========================================================================
$Id$

@authors: kiesel
@created: Fri Jun 23 15:57:36 CEST 2006
@status: draft
@category: scriptlet, <core>

Scope of Change
---------------
Several places in the scriptlet-API will be changed to use
scriptlet.HttpScriptletRequest::getEnvValue() instead of a
direct getenv() call.

Several places in the scriptlet-API will be changed to use
scriptlet.HttpScriptletRequest::getParam()/hasParam() methods
instead of accessing $_REQUEST/$_GET/$_POST/... directly.

The following is the list of restricted methods/variables:
. $_GET
. $_POST
. $_REQUEST
. $_COOKIE
. getenv()
. putenv()
. getallheaders()
. header()

Rationale
---------
In order to setup a scriptlet engine within a scriptlet-controlled
environment, access to the "outer" environment must be prevented. By
overriding the getEnvValue()/getParam()/...-methods this can be done.
The raw access cannot be overriden.

It's clear that there is no way of really intercepting access and 
calls to the raw data; so this document states the fact, it's for-
bidden, no further control is being done.

Violating the rule leads to undefined application behaviour by
definition.

Functionality
-------------
n/a

Security considerations
-----------------------
n/a

Speed impact
------------
Slightly slower due to an additional method call. Negligible.

Dependencies
------------
n/a

Related documents
-----------------
- http://xp-framework.net/rfc/contrib/rfc0061.diff
  Patch for scriptlet API to make conformant to this RFC

Comments
--------
- kiesel, Fri Jun 23 16:53:52 CEST 2006
  should $_SERVER also be restricted?

- kiesel, Mon Jun 26 11:23:37 CEST 2006
  scriptlet.xml.XmlScriptletResponse::forwardTo() uses getenv('REQUEST_URI')
  but does not have request object, so this case cannot be fixed without
  changing the API.

- kiesel, Mon Jun 26 13:25:46 CEST 2006
  Should methods accessing those "protected" variables or methods need
  to set a certain indicator (eg. a special annotation)?
  
  Example:
  
  #[@requestEnvironment('getenv()', '$_REQUEST')]
  function getEnvValue($name, $default= NULL) {
    // ...
  }

  Maybe there's a better name for the annotation...

<EOF>
